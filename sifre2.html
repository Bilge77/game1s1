<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Parallel Map Puzzle — Neon/Glitch</title>
<style>
  :root{
    --pink:#ff66b2; --pink-2:#ff99c8; --neon:#ff80ab; --ok:#00ffaa; --ink:#0d0d0f;
  }

  /* —— Page BG (soft animated gradient) —— */
  @keyframes bgShift {
    0%{background-position:0% 50%}
    50%{background-position:100% 50%}
    100%{background-position:0% 50%}
  }
  body{
    margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center;
    font-family:system-ui, Arial, sans-serif; text-align:center; color:#111;
    background:linear-gradient(120deg,#2a2a33,#3a2435,#1c1b28);
    background-size:200% 200%; animation:bgShift 14s ease-in-out infinite;
  }

  .wrap{max-width:980px; padding:20px 16px;}

  /* —— Riddle text with subtle chromatic glitch —— */
  .riddle{
    margin:0 0 18px; font-weight:700; line-height:1.35; color:#f9e6f0;
    text-shadow:0 0 10px rgba(255,0,120,.25);
    position:relative;
  }
  .riddle em{font-style:normal; color:#ff9ac7}
  .riddle::after, .riddle::before{
    content:attr(data-ghost);
    position:absolute; inset:0; pointer-events:none; mix-blend-mode:screen; opacity:.15;
  }
  .riddle::before{ transform:translate(1px,0); color:#00e1ff; }
  .riddle::after{  transform:translate(-1px,0); color:#ff2a7f; }
  @keyframes tinyJitter{ 0%,100%{transform:translate(0)} 50%{transform:translate(.2px,-.2px)} }
  .riddle::before,.riddle::after{ animation:tinyJitter 2.6s ease-in-out infinite; }

  /* —— Phone shell (neon border, glass) —— */
  .phone{
    width:360px; height:640px; margin:10px auto; border-radius:38px; padding:22px; position:relative;
    background:
      radial-gradient(60% 90% at 50% 10%, rgba(255,255,255,.35), transparent 60%),
      linear-gradient(135deg, #ff5ca8, #7c4dff 55%, #00e5ff);
    box-shadow:
      0 30px 60px rgba(0,0,0,.45),
      inset 0 0 0 2px rgba(255,255,255,.15),
      0 0 24px rgba(255, 92, 168, .45);
  }
  .phone::after{
    content:""; position:absolute; inset:10px; border-radius:30px;
    background:linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,0));
    pointer-events:none;
  }
  .speaker{position:absolute; top:10px; left:50%; transform:translateX(-50%);
    width:86px; height:8px; border-radius:6px; background:rgba(255,255,255,.35);}
  .screen{
    position:relative; width:100%; height:100%; border-radius:26px; overflow:hidden;
    background:#0d0f12; box-shadow:inset 0 0 18px rgba(0,0,0,.6);
    display:flex; align-items:center; justify-content:center;
  }

  /* —— fake CRT scanlines + noise —— */
  .screen::before{
    content:""; position:absolute; inset:0; pointer-events:none;
    background:repeating-linear-gradient(
      to bottom,
      rgba(255,255,255,.04) 0px,
      rgba(255,255,255,.04) 1px,
      transparent 2px,
      transparent 3px
    );
    mix-blend-mode:overlay; opacity:.25;
  }
  .noise{ position:absolute; inset:-20%; opacity:.06; background:
      url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="120" height="120"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="2" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23n)"/></svg>') center/200px repeat; animation:noiseMove 1.8s steps(2) infinite; pointer-events:none;}
  @keyframes noiseMove{ 50%{transform:translate3d(2px,-2px,0)} }

  /* —— Map layer —— */
  .map{ position:absolute; inset:0; background:url("map.jpg") center/contain no-repeat; transition:opacity .9s ease, transform .3s ease; }
  .fadeout{ opacity:0; transform:scale(1.02); }

  /* —— Neon points with breathing + ripple —— */
  @keyframes breathe {
    0%{ box-shadow:0 0 8px var(--neon), 0 0 16px var(--neon); transform:translate(-50%,-50%) scale(1) }
    50%{ box-shadow:0 0 14px var(--neon), 0 0 26px var(--neon); transform:translate(-50%,-50%) scale(1.06)}
    100%{ box-shadow:0 0 8px var(--neon), 0 0 16px var(--neon); transform:translate(-50%,-50%) scale(1) }
  }
  .point{
    position:absolute; width:20px; height:20px; border-radius:50%;
    background:#ff3d7b; border:2px solid #fff; cursor:pointer; touch-action:manipulation;
    transform:translate(-50%,-50%); animation:breathe 2.2s ease-in-out infinite;
  }
  .point.ok{ background:#19e68c; box-shadow:0 0 10px var(--ok),0 0 22px var(--ok) !important; animation:none; transform:translate(-50%,-50%) scale(1.05); }

  /* ripple ring on click */
  .point::after{
    content:""; position:absolute; inset:-6px; border-radius:inherit; border:2px solid rgba(255,255,255,.7);
    transform:scale(.2); opacity:0; pointer-events:none;
  }
  .point.ripple::after{ animation:ripple .45s ease-out; }
  @keyframes ripple{ from{opacity:.8; transform:scale(.2)} to{opacity:0; transform:scale(1.4)} }

  /* labels */
  .label{
    position:absolute; transform:translate(-50%, -120%);
    font-size:11px; letter-spacing:.02em; color:#fff;
    background:rgba(10,10,14,.55); border:1px solid rgba(255,255,255,.15);
    border-radius:6px; padding:2px 6px; opacity:.55; pointer-events:none; user-select:none;
    box-shadow:0 0 8px rgba(255, 128, 171, .25);
    transition:opacity .15s ease, transform .15s ease;
  }
  .point:hover + .label{ opacity:.95; transform:translate(-50%, -130%); }

  /* —— Result overlay with glitch —— */
  .result{
    position:absolute; inset:0; display:none; align-items:center; justify-content:center;
    background:radial-gradient(1200px 800px at 50% 100%, rgba(255,0,120,.25), rgba(0,0,0,.85) 60%, rgba(0,0,0,.92));
    color:#fff; padding:28px; box-sizing:border-box; text-align:center;
  }
  .result.show{ display:flex; animation:fadeIn 1s ease forwards; }
  @keyframes fadeIn{ from{opacity:0} to{opacity:1} }

  .badge{opacity:.8; letter-spacing:.18em; font-size:12px; color:#ffd6ea}
  .coords{
    font-size:28px; margin-top:8px; font-weight:800; letter-spacing:.02em;
    text-shadow:
      0 0 8px rgba(255, 0, 128, .45),
      0 0 22px rgba(255, 0, 128, .35);
    position:relative;
  }
  /* chromatic glitch lines */
  .coords::before, .coords::after{
    content:attr(data-txt); position:absolute; inset:0; mix-blend-mode:screen; opacity:.5; clip-path:inset(0 0 50% 0);
  }
  .coords::before{ color:#00e5ff; transform:translate(1px,0); animation:gl1 2s infinite steps(10); }
  .coords::after{  color:#ff2a7f; transform:translate(-1px,0); animation:gl2 2s infinite steps(12); }
  @keyframes gl1{ 50%{clip-path:inset(50% 0 0 0)} }
  @keyframes gl2{ 50%{clip-path:inset(0 0 65% 0)} }

  /* subtle success twinkle behind overlay */
  .twinkle{
    position:absolute; inset:-10%; background:
      radial-gradient(6px 6px at 10% 20%, rgba(255,255,255,.45), transparent 60%),
      radial-gradient(6px 6px at 80% 30%, rgba(255,255,255,.35), transparent 60%),
      radial-gradient(6px 6px at 30% 85%, rgba(255,255,255,.35), transparent 60%),
      radial-gradient(6px 6px at 65% 70%, rgba(255,255,255,.35), transparent 60%);
    filter:blur(.5px); animation:tw 4s linear infinite; opacity:.25; pointer-events:none;
  }
  @keyframes tw { to{ transform:translateY(-6px) } }

  /* utility */
  .hint{ color:#ffb7d7; font-size:12px; opacity:.8; margin-top:6px; }
</style>
</head>
<body>
<div class="wrap">
  <p class="riddle" data-ghost="My most special day is your day. Every year, right beside you, the years slipped by as we celebrated somewhere since 2023 in different places, yet always together… even before that.">
    “My most special day is <em>your</em> day. Every year, right beside you, the years slipped by as we celebrated somewhere since 2023 in different places, yet always together… even before that.”
  </p>

  <div class="phone" aria-label="pink phone">
    <div class="speaker"></div>
    <div class="screen">
      <div class="noise"></div>
      <div class="map" id="map"></div>

      <!-- hotspots (order is 1→2→3) -->
      <button class="point" id="p1" style="top:20%; left:24%;" aria-label="point"></button>
      <span class="label" aria-hidden="true" style="top:20%; left:24%;">ChefEdwards</span>

      <button class="point" id="p2" style="top:52%; left:78%;" aria-label="point"></button>
      <span class="label" aria-hidden="true" style="top:52%; left:78%;">CoffeeshopCompany</span>

      <button class="point" id="p3" style="top:82%; left:38%;" aria-label="point"></button>
      <span class="label" aria-hidden="true" style="top:82%; left:38%;">Forum Gloria</span>

      <div class="result" id="result" role="status" aria-live="polite">
        <div class="twinkle"></div>
        <div>
          <div class="badge">COORDINATES</div>
          <div class="coords" id="coords" data-txt="40.9993249, 39.7598470">40.9993249, 39.7598470</div>
          <div class="hint">tap anywhere to replay</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- sounds -->
<audio id="click" src="telegraph.mp3" preload="auto"></audio>
<audio id="bg" src="bg_music.mp3" preload="auto" loop></audio>

<script>
  // keep original logic; only visual extras added

  // BG music after first interaction
  const bg = document.getElementById('bg');
  const clickS = document.getElementById('click');
  const armBG = () => { bg.play().catch(()=>{}); document.removeEventListener('pointerdown', armBG); };
  document.addEventListener('pointerdown', armBG, {once:true});

  const sequence = ['p1','p2','p3']; // order preserved
  let step = 0;

  function playClick(){
    try{ clickS.currentTime = 0; clickS.play(); }catch(e){}
  }

  function resetPoints(){
    step = 0;
    document.querySelectorAll('.point').forEach(el=>el.classList.remove('ok'));
    // restore map if hidden
    document.getElementById('map').classList.remove('fadeout');
    document.getElementById('result').classList.remove('show');
  }

  // add subtle parallax to map (purely visual)
  const screen = document.querySelector('.screen');
  const map = document.getElementById('map');
  screen.addEventListener('mousemove', (e)=>{
    const r = screen.getBoundingClientRect();
    const x = ((e.clientX - r.left)/r.width - .5) * 2;
    const y = ((e.clientY - r.top)/r.height - .5) * 2;
    map.style.transform = `translate(${x*4}px, ${y*4}px)`;
  });
  screen.addEventListener('mouseleave', ()=> map.style.transform='');

  // points: logic + ripple class for click effect
  document.querySelectorAll('.point').forEach(el=>{
    el.addEventListener('click', ()=>{
      playClick();

      // ripple pulse (visual)
      el.classList.remove('ripple'); // restart animation
      void el.offsetWidth;
      el.classList.add('ripple');

      if(el.id === sequence[step]){
        el.classList.add('ok');
        step++;
        if(step === sequence.length){
          // success → fade map, reveal coordinates (same logic)
          document.getElementById('map').classList.add('fadeout');
          setTimeout(()=>document.getElementById('result').classList.add('show'), 700);
        }
      }else{
        // wrong order → soft reset (same logic)
        resetPoints();
      }
    });
  });

  // tap overlay to replay (quality-of-life, does not change puzzle logic)
  document.getElementById('result').addEventListener('click', resetPoints);
</script>
</html>
