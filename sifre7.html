<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Letter</title>
<style>
  :root{
    --bg:#000; --ink:#f5f5f7; --glow:#b78cff;
    --accent1:#ff3b81; --accent2:#49c6ff;
  }
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--ink);
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
    display:flex; align-items:center; justify-content:center; overflow:hidden;
  }

  /* hafif CRT/film grain + vignette */
  .fx-grain::before{
    content:""; position:fixed; inset:-20%; pointer-events:none; opacity:.08; mix-blend-mode:screen;
    background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='2'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
    background-size:180px 180px; animation:grain 1.3s steps(6) infinite;
  }
  .fx-grain::after{
    content:""; position:fixed; inset:0; pointer-events:none;
    background:radial-gradient(1200px 700px at 50% -10%, transparent 35%, rgba(0,0,0,.35) 75%);
  }
  @keyframes grain{to{transform:translate3d(3px,3px,0)}}

  .wrap{
    width:min(92vw,900px); max-height:86vh; padding:28px clamp(18px,3vw,32px);
    border:1px solid rgba(255,255,255,.08); border-radius:16px;
    background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01));
    box-shadow: 0 0 80px rgba(183,140,255,.12), inset 0 0 30px rgba(255,255,255,.03);
    overflow:auto; position:relative;
  }

  /* titreşimli neon kenar */
  .wrap::before{
    content:""; position:absolute; inset:-2px; border-radius:18px;
    background: conic-gradient(from 0deg, rgba(183,140,255,.25), rgba(73,198,255,.18), rgba(255,59,129,.18), rgba(183,140,255,.25));
    filter: blur(16px); opacity:.35; z-index:-1; animation:halo 8s linear infinite;
  }
  @keyframes halo{to{transform:rotate(360deg)}}

  /* mektup metni */
  #letter{
    line-height:1.7; font-size:clamp(16px,2.1vw,20px);
    text-shadow: 0 0 8px rgba(183,140,255,.22), 0 0 22px rgba(73,198,255,.12);
    white-space:pre-wrap;
  }

  /* tek tek belirme */
  .line{opacity:0; filter:blur(6px); transform:translateY(6px);}
  .line.show{
    opacity:1; filter:blur(0); transform:translateY(0);
    transition: opacity .55s ease, filter .55s ease, transform .55s ease;
  }

  /* harflerde hafif shimmer */
  .shimmer{
    background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(183,140,255,.4) 45%, rgba(73,198,255,.35) 55%, rgba(255,255,255,0) 100%);
    -webkit-background-clip:text; background-clip:text; color:transparent;
    animation:shine 2.8s ease-in-out infinite;
  }
  @keyframes shine{
    0%,10%{background-position:-200% 0}
    40%,60%{background-position:200% 0}
    100%{background-position:200% 0}
  }

  /* glitch efekt */
  .glitch {
    position: relative; display:inline-block;
  }
  .glitch::before, .glitch::after{
    content: attr(data-text);
    position:absolute; left:0; top:0; width:100%; overflow:hidden; pointer-events:none;
  }
  .glitch::before{
    color: var(--accent1); clip-path: inset(0 0 0 0);
    animation: g1 1.6s infinite linear alternate-reverse;
    mix-blend-mode:screen; opacity:.6;
  }
  .glitch::after{
    color: var(--accent2); clip-path: inset(0 0 0 0);
    animation: g2 1.3s infinite linear alternate;
    mix-blend-mode:screen; opacity:.6;
  }
  @keyframes g1{
    0%{transform:translate(0,0)} 20%{transform:translate(-1px,-1px)}
    40%{transform:translate(1px,1px)} 60%{transform:translate(-2px,1px)}
    80%{transform:translate(2px,-1px)} 100%{transform:translate(0,0)}
  }
  @keyframes g2{
    0%{transform:translate(0,0)} 25%{transform:translate(1px,-1px)}
    50%{transform:translate(-1px,1px)} 75%{transform:translate(2px,1px)}
    100%{transform:translate(0,0)}
  }

  /* alt ipucu ve ilerleme */
  .sub{
    opacity:.7; font-size:12px; letter-spacing:.06em; margin-top:14px;
  }
  .progress{
    height:2px; width:0; background:linear-gradient(90deg, var(--glow), transparent);
    box-shadow:0 0 10px var(--glow); transition:width .35s ease;
  }
</style>
</head>
<body class="fx-grain">
  <div class="wrap">
    <div id="letter"></div>
    <div class="progress" id="bar"></div>
    <div class="sub" id="hint"></div>
  </div>

<script>
/* ========= AYARLAR ========= */
const TYPE_SPEED = 18;        // harf yazma hızı (ms)
const LINE_DELAY = 200;       // satır arası gecikme (ms)
const USE_GLITCH = true;      // başlıklara glitch uygula
const SHIMMER_ALL = true;     // tüm harflerde shimmer uygula

/* ======= BURAYA MEKTUBU YAPIŞTIR ======= */
const LETTER = `
Ashley, I don’t even know where to start. I wanted to give you this as a confession, clean and simple and then the whole “parallel versions” thing crashed through the door. Your body is the same but I can feel pieces of the other yous like sparks under your skin and it makes everything tilt. I’m not shocked by the multiverse anymore. 
After what the demon showed us, that sick little prophecy, of course it was coming.
After everything we’ve crawled through, all the dark, messed-up nights, is this really the thing that should surprise me? No.
Only one thing still hits me like a freight tornado: I miss you. God, I miss the car, the way chaos would wrap around us like a seatbelt, 
the way a stupid song could make us both laugh and forget the blood on our shoes. I miss the way being with you made the world shut up.
This was supposed to be a normal confession. But maybe it’s not. Maybe nothing about me is normal.
My whole life, they tried to frame me with nice borders, neat labels. But at my core there’s always been that cherry red flares, the little fire 
that won’t sit still. I kept it hidden under black paint, told myself I wasn’t that person, tried to smother it until I couldn’t breathe. 
Then there was you. High school. You sat next to me like a knife slipping into a lock. You were a silhouette 
that sharpened the dark and somehow you gave the dark purpose. I wanted to be the one lighten our path in our beautiful darkness, 
I did that with my cherry red sparks from flares to make a crown for your quiet. No limits. You made me remember that. 
You made me remember that I was free, that the rules were paper, and fire eats paper. 
You make me feel alive. That’s the whole truth. With you. With you. With you. 
I live for the look in your eyes when you need me, the breath that catches, the tiny tremor in your voice, 
the way your hand finds mine without asking. I would do it all again, baby. Every bad decision, every burned bridge, 
every long drive with sirens in the mirror. With you. A thousand times. 
The thing no one understands about us is that the wreckage was never a problem to be solved. 
It was the imbalance, the volatility, the madness itself that we chose to live inside but with each other in our true balance.
And we carried it, we kept it breathing, when everyone else would have run. That’s what made us us. 
No matter how much they judged, no matter how much they tried to name it wrong, we knew. 
The chaos wasn’t what broke us. It was what bound us. That’s our dynamic. 
That’s the home I found. Not a house, not a city but you. 
And now the universes keep folding like paper cranes, and each one tries to hand me a slightly different you. 
I get why you feel different how could you not? Every Ashley carries a secret load: a memory that didn’t happen here.
I shouldn’t be jealous of my own shadows, but I am. I want this you, the one in front of me now, to know the full weight of how I love you
not the copy, not the echo. don’t care how many versions of us exist. I will keep choosing you in every single one.
I will choose you in the car that goes low. I will choose you in the late-night grocery aisle under dead lights. 
I will choose you under bad omens and neon signs and skies that look like they’re about to split. 
If the demon was right and the map keeps tearing, let it. Let it all tear.
I will stitch it with cherry red thread and call it a path back to you. 
I’m here. I’m not stepping back. If you need me, breathe once, and I’ll know which world to run through.

— scarlet
`;
/* ====================================== */

const container = document.getElementById('letter');
const bar = document.getElementById('bar');
const hint = document.getElementById('hint');

function makeLineHTML(text){
  // İlk satır “başlık” gibi görünüyorsa glitch verelim
  const isTitle = text.trim().length <= 42 && /^[\[\(«“"']?[\w\-—]/i.test(text.trim());
  const safe = text
    .replace(/&/g,'&amp;')
    .replace(/</g,'&lt;')
    .replace(/>/g,'&gt;');

  const inner = SHIMMER_ALL
    ? `<span class="shimmer">${safe}</span>`
    : safe;

  if(USE_GLITCH && isTitle){
    return `<div class="line"><span class="glitch" data-text="${safe}">${inner}</span></div>`;
  }
  return `<div class="line">${inner}</div>`;
}

function typeLine(el, text, done){
  el.innerHTML = ""; // progressive type
  const chars = text.split("");
  let i = 0;
  const tick = () => {
    if(i < chars.length){
      const ch = chars[i++];
      el.innerHTML += SHIMMER_ALL ? `<span class="shimmer">${ch === '\n' ? '<br>' : ch}</span>` : (ch === '\n' ? '<br>' : ch);
      setTimeout(tick, TYPE_SPEED);
    } else {
      done && done();
    }
  };
  tick();
}

function animateLetter(){
  const parts = LETTER.trim().split(/\n\s*\n/); // paragraflara böl
  const lines = parts.map(p => p.trim()).filter(Boolean);
  const total = lines.length;
  let shown = 0;

  function next(){
    if(shown >= total){
      hint.textContent = ""; bar.style.width = "100%";
      return;
    }
    const html = makeLineHTML(lines[shown]);
    container.insertAdjacentHTML('beforeend', html);
    const node = container.lastElementChild;
    // görünür yap
    setTimeout(()=> node.classList.add('show'), 10);

    // yazma efekti (satırın içine yaz)
    const raw = lines[shown];
    const target = node.querySelector('.glitch') || node;
    // yalnızca yazı yazılacak düz element:
    // glitch içinde shimmer span varsa, ayrı işleyelim
    if(target.classList.contains('glitch')){
      // glitch'in içindeki gerçek görünen metin target'ın kendisi
      typeLine(target, raw, () => {
        shown++;
        bar.style.width = `${Math.round((shown/total)*100)}%`;
        setTimeout(next, LINE_DELAY);
      });
    }else{
      typeLine(target, raw, () => {
        shown++;
        bar.style.width = `${Math.round((shown/total)*100)}%`;
        setTimeout(next, LINE_DELAY);
      });
    }
  }

  hint.textContent = "decoding…";
  next();
}

document.addEventListener('DOMContentLoaded', animateLetter);
</script>
</body>
</html>

